<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Le Bug des Boucles D√©croissantes</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .slide {
            background: white;
            border-radius: 15px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transform: translateY(20px);
            opacity: 0;
            animation: slideIn 0.6s ease forwards;
        }

        @keyframes slideIn {
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        h1 {
            color: #e74c3c;
            font-size: 2.5em;
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        h2 {
            color: #2c3e50;
            font-size: 2em;
            margin-bottom: 20px;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }

        h3 {
            color: #34495e;
            font-size: 1.4em;
            margin: 20px 0 10px 0;
        }

        .code-block {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
            overflow-x: auto;
            position: relative;
        }

        .code-block::before {
            content: attr(data-lang);
            position: absolute;
            top: 5px;
            right: 10px;
            font-size: 0.8em;
            color: #95a5a6;
        }

        .highlight-error {
            background: #e74c3c;
            color: white;
            padding: 2px 4px;
            border-radius: 3px;
        }

        .highlight-correct {
            background: #27ae60;
            color: white;
            padding: 2px 4px;
            border-radius: 3px;
        }

        .warning-box {
            background: #f39c12;
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 5px solid #e67e22;
        }

        .danger-box {
            background: #e74c3c;
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 5px solid #c0392b;
        }

        .success-box {
            background: #27ae60;
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 5px solid #229954;
        }

        .demo-container {
            background: #ecf0f1;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .binary-display {
            font-family: 'Courier New', monospace;
            font-size: 1.2em;
            text-align: center;
            margin: 10px 0;
        }

        .interactive-demo {
            text-align: center;
            margin: 20px 0;
        }

        button {
            background: #3498db;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            margin: 5px;
            transition: background 0.3s ease;
        }

        button:hover {
            background: #2980b9;
        }

        .step-counter {
            font-size: 1.5em;
            color: #e74c3c;
            font-weight: bold;
        }

        ul {
            margin-left: 20px;
            margin-bottom: 15px;
        }

        li {
            margin-bottom: 8px;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .comparison-table th,
        .comparison-table td {
            border: 2px solid #bdc3c7;
            padding: 12px;
            text-align: left;
        }

        .comparison-table th {
            background: #34495e;
            color: white;
        }

        .comparison-table .error-row {
            background: #ffeaa7;
        }

        .comparison-table .success-row {
            background: #a8e6cf;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Slide 1: Titre -->
        <div class="slide">
            <h1>üêõ Le Pi√®ge Mortel des Boucles D√©croissantes</h1>
            <div style="text-align: center; font-size: 1.3em; color: #7f8c8d; margin-top: 20px;">
                <strong>Types Non Sign√©s vs Boucles for(;;i--)</strong><br>
                <em>Un bug subtil qui peut paralyser votre microcontr√¥leur</em>
            </div>
        </div>

        <!-- Slide 2: Le Code Probl√©matique -->
        <div class="slide">
            <h2>üîç Le Code qui Pose Probl√®me</h2>
            
            <div class="code-block" data-lang="C">
// ‚ùå CODE BUGG√â - Boucle infinie garantie !
void ad5144_write_rdac(uint8_t rdac_channel, uint8_t value) {
    // ...
    <span class="highlight-error">for (uint8_t i = 15; i >= 0; i--)</span> {  // PI√àGE !
        SDI = (configpot >> i) & 1;
        // ... transmission SPI
    }
    // Ce code ne sera JAMAIS atteint !
}</div>

            <div class="danger-box">
                <strong>‚ö†Ô∏è Sympt√¥me :</strong> Le microcontr√¥leur se fige, aucune tension n'appara√Æt sur W4, le syst√®me semble "mort".
            </div>
        </div>

        <!-- Slide 3: Pourquoi √ßa ne marche pas -->
        <div class="slide">
            <h2>ü§î Mais Pourquoi √ßa ne Marche Pas ?</h2>
            
            <h3>Le Probl√®me : uint8_t est un type NON SIGN√â</h3>
            
            <div class="demo-container">
                <div style="text-align: center;">
                    <strong>Valeurs possibles pour uint8_t :</strong><br>
                    <span class="binary-display">0 ‚Üí 1 ‚Üí 2 ‚Üí ... ‚Üí 254 ‚Üí 255 ‚Üí <span style="color: #e74c3c;">0 (WRAP!)</span></span>
                </div>
            </div>

            <div class="interactive-demo">
                <p><strong>Simulation de la boucle :</strong></p>
                <div id="loopDemo">
                    <div>Valeur de i : <span class="step-counter" id="iValue">15</span></div>
                    <div>Condition i >= 0 : <span id="condition" style="color: #27ae60;">‚úÖ VRAIE</span></div>
                    <div>√âtape : <span id="stepNumber">0</span></div>
                </div>
                <button onclick="nextStep()">√âtape Suivante</button>
                <button onclick="resetDemo()">Reset</button>
            </div>
        </div>

        <!-- Slide 4: Le M√©canisme du Bug -->
        <div class="slide">
            <h2>‚öôÔ∏è Le M√©canisme du Bug</h2>
            
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>√âtape</th>
                        <th>Valeur de i</th>
                        <th>Binaire (8 bits)</th>
                        <th>Condition i >= 0</th>
                        <th>Continue ?</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>D√©but</td>
                        <td>15</td>
                        <td>00001111</td>
                        <td>‚úÖ Vraie</td>
                        <td>Oui</td>
                    </tr>
                    <tr>
                        <td>...</td>
                        <td>...</td>
                        <td>...</td>
                        <td>‚úÖ Vraie</td>
                        <td>Oui</td>
                    </tr>
                    <tr>
                        <td>Avant le pi√®ge</td>
                        <td>1</td>
                        <td>00000001</td>
                        <td>‚úÖ Vraie</td>
                        <td>Oui</td>
                    </tr>
                    <tr>
                        <td>Avant le pi√®ge</td>
                        <td>0</td>
                        <td>00000000</td>
                        <td>‚úÖ Vraie</td>
                        <td>Oui</td>
                    </tr>
                    <tr class="error-row">
                        <td><strong>LE PI√àGE !</strong></td>
                        <td><strong>255</strong></td>
                        <td><strong>11111111</strong></td>
                        <td><strong>‚úÖ Vraie (!!)</strong></td>
                        <td><strong>OUI ‚Üí INFINI</strong></td>
                    </tr>
                </tbody>
            </table>

            <div class="warning-box">
                <strong>üîë Point cl√© :</strong> Un uint8_t ne peut JAMAIS √™tre n√©gatif ! 
                La condition <code>i >= 0</code> est <em>toujours vraie</em> pour un type non sign√©.
            </div>
        </div>

        <!-- Slide 5: Solutions -->
        <div class="slide">
            <h2>‚úÖ Les Solutions qui Fonctionnent</h2>
            
            <h3>Solution 1 : Type Sign√© (Recommand√©e)</h3>
            <div class="code-block" data-lang="C">
// ‚úÖ SOLUTION SIMPLE ET EFFICACE
<span class="highlight-correct">for (int i = 15; i >= 0; i--)</span> {
    SDI = (configpot >> i) & 1;
    // ... reste du code
}
// int peut devenir n√©gatif ‚Üí condition devient fausse ‚Üí boucle s'arr√™te</div>

            <h3>Solution 2 : Boucle D√©croissante S√©curis√©e</h3>
            <div class="code-block" data-lang="C">
// ‚úÖ ASTUCE : Boucle de 16 √† 1
<span class="highlight-correct">for (uint8_t i = 16; i > 0; i--)</span> {
    SDI = (configpot >> (i-1)) & 1;  // Utilise (i-1) = 15‚Üí0
    // ... reste du code
}</div>

            <h3>Solution 3 : Boucle Croissante</h3>
            <div class="code-block" data-lang="C">
// ‚úÖ INVERSION DE LA LOGIQUE
<span class="highlight-correct">for (uint8_t i = 0; i < 16; i++)</span> {
    SDI = (configpot >> (15-i)) & 1;  // Calcul de l'index d√©croissant
    // ... reste du code
}</div>
        </div>

        <!-- Slide 6: Comparaison Pratique -->
        <div class="slide">
            <h2>‚öñÔ∏è Comparaison des Solutions</h2>
            
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>Solution</th>
                        <th>Lisibilit√©</th>
                        <th>Performance</th>
                        <th>S√©curit√©</th>
                        <th>Recommandation</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="success-row">
                        <td><strong>int i = 15; i >= 0; i--</strong></td>
                        <td>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</td>
                        <td>‚≠ê‚≠ê‚≠ê‚≠ê</td>
                        <td>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</td>
                        <td><strong>MEILLEURE</strong></td>
                    </tr>
                    <tr class="success-row">
                        <td><strong>uint8_t i = 16; i > 0; i--</strong></td>
                        <td>‚≠ê‚≠ê‚≠ê</td>
                        <td>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</td>
                        <td>‚≠ê‚≠ê‚≠ê‚≠ê</td>
                        <td>Bonne alternative</td>
                    </tr>
                    <tr>
                        <td><strong>uint8_t i = 0; i < 16; i++</strong></td>
                        <td>‚≠ê‚≠ê</td>
                        <td>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</td>
                        <td>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</td>
                        <td>Acceptable</td>
                    </tr>
                    <tr class="error-row">
                        <td><strong>uint8_t i = 15; i >= 0; i--</strong></td>
                        <td>üíÄ</td>
                        <td>üíÄ</td>
                        <td>üíÄ</td>
                        <td><strong>INTERDITE</strong></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Slide 7: Comment D√©tecter ce Bug -->
        <div class="slide">
            <h2>üîç Comment D√©tecter ce Bug</h2>
            
            <h3>Signaux d'Alerte</h3>
            <ul>
                <li><strong>Syst√®me qui "se fige"</strong> de mani√®re inexpliqu√©e</li>
                <li><strong>Boucle qui ne se termine jamais</strong></li>
                <li><strong>Microcontr√¥leur qui ne r√©pond plus</strong></li>
                <li><strong>Code qui fonctionne en simulation mais pas sur hardware</strong></li>
            </ul>

            <h3>Techniques de Debug</h3>
            <div class="code-block" data-lang="C">
// üîß Ajout de debug pour identifier le probl√®me
for (uint8_t i = 15; i >= 0; i--) {
    printf("i = %d\n", i);  // ‚Üê Ceci r√©v√©lerait le probl√®me !
    if (debug_counter++ > 20) break;  // ‚Üê Protection anti-boucle infinie
    // ... votre code
}</div>

            <div class="success-box">
                <strong>üí° Pro Tip :</strong> Activez toujours les warnings du compilateur ! 
                Certains compilateurs peuvent d√©tecter ce pattern dangereux.
            </div>
        </div>

        <!-- Slide 8: Bonnes Pratiques -->
        <div class="slide">
            <h2>üìö Bonnes Pratiques</h2>
            
            <h3>‚úÖ √Ä Faire</h3>
            <ul>
                <li>Utiliser <strong>int</strong> pour les compteurs de boucle sauf contrainte forte</li>
                <li>Privil√©gier les <strong>boucles croissantes</strong> quand possible</li>
                <li>Tester les <strong>cas limites</strong> (0, valeurs maximales)</li>
                <li>Activer les <strong>warnings du compilateur</strong></li>
                <li>Utiliser des <strong>outils d'analyse statique</strong></li>
            </ul>

            <h3>‚ùå √Ä √âviter</h3>
            <ul>
                <li>Boucles d√©croissantes avec types <strong>non sign√©s</strong></li>
                <li>Conditions <code>unsigned_var >= 0</code> (toujours vraie !)</li>
                <li>Optimisations pr√©matur√©es avec types courts</li>
                <li>Tests insuffisants sur hardware r√©el</li>
            </ul>

            <div class="warning-box">
                <strong>‚ö° R√®gle d'Or :</strong> 
                "Si vous h√©sitez entre int et uint8_t pour un compteur de boucle, choisissez int !"
            </div>
        </div>

        <!-- Slide 9: Conclusion -->
        <div class="slide">
            <h2>üéØ Points Cl√©s √† Retenir</h2>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                <div class="danger-box">
                    <h3>üö´ Le Pi√®ge</h3>
                    <p>Les types non sign√©s ne peuvent jamais √™tre n√©gatifs</p>
                    <p><code>uint8_t i >= 0</code> est toujours vrai</p>
                    <p>Boucle infinie garantie !</p>
                </div>
                
                <div class="success-box">
                    <h3>‚úÖ La Solution</h3>
                    <p>Utilisez <code>int</code> pour les compteurs</p>
                    <p>Ou adaptez la logique de boucle</p>
                    <p>Testez toujours les cas limites !</p>
                </div>
            </div>

            <div style="text-align: center; margin-top: 30px; font-size: 1.2em; color: #2c3e50;">
                <strong>Ce bug subtil peut co√ªter des heures de debug...</strong><br>
                <em>Mais maintenant vous savez comment l'√©viter ! üéâ</em>
            </div>
        </div>
    </div>

    <script>
        let currentValue = 15;
        let stepCount = 0;
        
        function nextStep() {
            const iValueEl = document.getElementById('iValue');
            const conditionEl = document.getElementById('condition');
            const stepNumberEl = document.getElementById('stepNumber');
            
            stepCount++;
            stepNumberEl.textContent = stepCount;
            
            if (currentValue > 0) {
                currentValue--;
                iValueEl.textContent = currentValue;
                conditionEl.innerHTML = '<span style="color: #27ae60;">‚úÖ VRAIE</span>';
            } else if (currentValue === 0) {
                // Simulation du wrap-around
                currentValue = 255;
                iValueEl.textContent = currentValue;
                conditionEl.innerHTML = '<span style="color: #e74c3c;">‚úÖ VRAIE (PI√àGE!)</span>';
                iValueEl.style.color = '#e74c3c';
                iValueEl.style.fontWeight = 'bold';
            } else {
                // D√©j√† dans la boucle infinie
                conditionEl.innerHTML = '<span style="color: #e74c3c;">‚úÖ TOUJOURS VRAIE ‚Üí BOUCLE INFINIE!</span>';
            }
        }
        
        function resetDemo() {
            currentValue = 15;
            stepCount = 0;
            document.getElementById('iValue').textContent = '15';
            document.getElementById('iValue').style.color = '#e74c3c';
            document.getElementById('iValue').style.fontWeight = 'bold';
            document.getElementById('condition').innerHTML = '<span style="color: #27ae60;">‚úÖ VRAIE</span>';
            document.getElementById('stepNumber').textContent = '0';
        }

        // Animation des slides au chargement
        document.addEventListener('DOMContentLoaded', function() {
            const slides = document.querySelectorAll('.slide');
            slides.forEach((slide, index) => {
                slide.style.animationDelay = `${index * 0.2}s`;
            });
        });
    </script>
</body>
</html>
